---
import "../styles/global.css";
import { type MarkdownLayoutProps } from "astro";
import CommandLine from "../components/CommandLine.astro";
import ArticleProse from "../components/ArticleProse.astro";
import GeneralLayout from "./GeneralLayout.astro";
import { getImage, Image } from "astro:assets";

type Props = MarkdownLayoutProps<{
    title: string;
    publishedAt: string;
    image: string;
    imgCaption?: string;
    startPeriod?: string;
    endPeriod?: string;
}>;

// Extract frontmatter
const { frontmatter, url, file } = Astro.props;

// Dynaimcally import image
const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/images/**/*.{jpg,jpeg,png,webp}",
);
const image = frontmatter.image.startsWith("http")
    ? frontmatter.image
    : (await images[frontmatter.image]()).default;

// Compute date
const parsedDate = new Date(frontmatter.publishedAt).toLocaleString("en-GB", {
    weekday: "long",
    month: "long",
    day: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
});

const date = parsedDate;

// Extract the file name
// Get only the file name
const fileName = file.split("/").pop() as string;
---

<GeneralLayout path={url as string} title={frontmatter.title}>
    <CommandLine keyword="cat" text={fileName} />

    <!-- Header -->
    <div class="my-10">
        <h1 class="text-3xl text-catpuccin-text md:text-4xl lg:text-5xl">
            {frontmatter.title}
        </h1>

        <!-- For project -->
        <p>
            {
                frontmatter.startPeriod &&
                    `${frontmatter.startPeriod} - ${frontmatter.endPeriod || "present"} `
            }
        </p>

        <!-- For Blog -->
        <p class="text-catpuccin-subtext-0">
            published at {date}
        </p>
    </div>

    <!-- Article grid -->
    <main class="grid grid-cols-1 justify-between lg:grid-cols-2">
        <ArticleProse>
            <slot />
        </ArticleProse>

        <div class="order-first mb-4 w-full lg:order-last">
            <Image
                class="max-h-[360px] w-full border border-catpuccin-mauve object-cover p-4"
                src={image as ImageMetadata}
                width={typeof image === "string" ? 600 : undefined}
                height={typeof image === "string" ? 400 : undefined}
                alt={frontmatter.imgCaption || frontmatter.title}
                loading={"eager"}
            />

            <div class="mt-2 bg-catpuccin-mauve p-3 text-catpuccin-base">
                <p>{frontmatter.imgCaption || frontmatter.title}</p>
            </div>
        </div>
    </main>
</GeneralLayout>
